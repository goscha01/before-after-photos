<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#667eea" />
    <meta name="description" content="Mobile-first cleaning photo documentation app" />

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <!-- Prevent zoom on input fields -->
    <meta name="format-detection" content="telephone=no" />

    <!-- Status bar styling for iOS -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Cleaning App" />
    
    <!-- Additional iOS compatibility -->
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="apple-mobile-web-app-orientations" content="portrait" />

    <title>Cleaning Photo App</title>

    <style>
      /* Prevent flash of unstyled content */
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        background-color: #f8fafc;
        color: #1e293b;
        overscroll-behavior: none;
      }

      /* Loading spinner */
      .loading-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8fafc;
        z-index: 9999;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #e2e8f0;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Hide loading once React loads */
      #root:not(:empty) + .loading-container {
        display: none;
      }

      /* Debug info */
      .debug-info {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 10000;
        max-width: 300px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <div class="loading-container">
      <div class="loading-spinner"></div>
    </div>
    
    <!-- Debug info (hidden by default) -->
    <div class="debug-info" id="debug-info" style="display: none;">
      <div>üöÄ HTML Loaded</div>
      <div>üì± User Agent: <span id="user-agent">Loading...</span></div>
      <div>üåê Location: <span id="location">Loading...</span></div>
      <div>‚è∞ Time: <span id="time">Loading...</span></div>
    </div>
    
    <script>
      // Basic debug info
      console.log('üöÄ Debug: HTML loaded');
      console.log('üöÄ Debug: User Agent:', navigator.userAgent);
      console.log('üöÄ Debug: Location:', window.location.href);
      
      // Update debug info
      document.getElementById('user-agent').textContent = navigator.userAgent.substring(0, 50) + '...';
      document.getElementById('location').textContent = window.location.href;
      document.getElementById('time').textContent = new Date().toLocaleTimeString();
      
      // Check if we're on iOS
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      console.log('üöÄ Debug: Is iOS:', isIOS);
      
      if (isIOS) {
        document.getElementById('debug-info').innerHTML += '<div style="color: #ff6b6b;">üçé iOS Detected</div>';
      }
      
      // Check if React loads
      let reactLoadTimer = setTimeout(() => {
        console.log('‚ùå Debug: React failed to load within 10 seconds');
        document.getElementById('debug-info').innerHTML += '<div style="color: #ff6b6b;">‚ùå React Failed to Load</div>';
      }, 10000);
      
      // Clear timer when React loads
      window.addEventListener('load', () => {
        clearTimeout(reactLoadTimer);
        console.log('‚úÖ Debug: Page fully loaded');
      });
      
      // Check for React errors
      window.addEventListener('error', (e) => {
        console.log('‚ùå Debug: JavaScript error:', e.error);
        document.getElementById('debug-info').innerHTML += '<div style="color: #ff6b6b;">‚ùå JS Error: ' + e.error.message + '</div>';
      });
      
      // Check for unhandled promise rejections
      window.addEventListener('unhandledrejection', (e) => {
        console.log('‚ùå Debug: Unhandled promise rejection:', e.reason);
        document.getElementById('debug-info').innerHTML += '<div style="color: #ff6b6b;">‚ùå Promise Error: ' + e.reason + '</div>';
      });
      
      // Monitor script loading
      const scripts = document.querySelectorAll('script[type="module"]');
      scripts.forEach((script, index) => {
        script.addEventListener('load', () => {
          console.log('‚úÖ Debug: Script ' + index + ' loaded successfully');
          document.getElementById('debug-info').innerHTML += '<div style="color: green;">‚úÖ Script ' + index + ' loaded</div>';
        });
        script.addEventListener('error', (e) => {
          console.log('‚ùå Debug: Script ' + index + ' failed to load:', e);
          document.getElementById('debug-info').innerHTML += '<div style="color: red;">‚ùå Script ' + index + ' failed: ' + e.message + '</div>';
        });
      });
      
      // Check if main.jsx loads
      console.log('üöÄ Debug: About to load main.jsx');
    </script>
    
    <!-- Simple JavaScript test -->
    <script>
      console.log('üß™ Debug: Testing basic JavaScript...');
      
      // Test if we can create DOM elements
      try {
        const testDiv = document.createElement('div');
        testDiv.innerHTML = '<div style="color: green;">‚úÖ Basic JavaScript Works!</div>';
        document.getElementById('debug-info').appendChild(testDiv);
        console.log('‚úÖ Debug: Basic JavaScript works');
      } catch (e) {
        console.log('‚ùå Debug: Basic JavaScript failed:', e);
      }
      
      // Test if we can fetch (for checking if the app files exist)
      fetch('/src/main.jsx')
        .then(response => {
          console.log('‚úÖ Debug: main.jsx file exists, status:', response.status);
          if (response.status === 200) {
            document.getElementById('debug-info').innerHTML += '<div style="color: green;">‚úÖ main.jsx file exists</div>';
          } else {
            document.getElementById('debug-info').innerHTML += '<div style="color: red;">‚ùå main.jsx file not found (status: ' + response.status + ')</div>';
          }
        })
        .catch(error => {
          console.log('‚ùå Debug: Cannot fetch main.jsx:', error);
          document.getElementById('debug-info').innerHTML += '<div style="color: red;">‚ùå Cannot fetch main.jsx: ' + error.message + '</div>';
        });
    </script>
    
    <!-- Try a very simple inline test first -->
    <script>
      console.log('üß™ Debug: Inline script starting...');
      try {
        const root = document.getElementById('root');
        if (root) {
          root.innerHTML = '<div style="padding: 20px; color: green; font-family: Arial, sans-serif;"><h1>‚úÖ Inline Script Works!</h1><p>JavaScript is executing on iPhone!</p></div>';
          console.log('‚úÖ Debug: Inline script successful');
        } else {
          console.log('‚ùå Debug: Root element not found in inline script');
        }
      } catch (e) {
        console.log('‚ùå Debug: Inline script error:', e);
      }
    </script>
    
    <!-- Try regular script (not module) -->
    <script>
      console.log('üß™ Debug: Testing regular script execution...');
      
      try {
        const rootElement = document.getElementById('root');
        if (rootElement) {
          rootElement.innerHTML = '<div style="padding: 20px; color: green; font-family: Arial, sans-serif;"><h1>‚úÖ Regular Script Works!</h1><p>This proves regular JavaScript works on iOS Safari.</p><p>Now loading bundled React app...</p></div>';
          console.log('‚úÖ Debug: Regular script execution successful');
        }
      } catch (error) {
        console.log('‚ùå Debug: Regular script failed:', error);
      }
    </script>
    
    <!-- iOS Safari Compatible Cleaning Photo App -->
    <script>
      console.log('üöÄ Debug: Loading iOS Safari compatible version...');
      
      // Simple photo documentation app
      class CleaningPhotoApp {
        constructor() {
          this.photos = [];
          this.currentRoom = 'kitchen';
          this.currentMode = 'before';
          this.init();
        }
        
        init() {
          const rootElement = document.getElementById('root');
          if (rootElement) {
            rootElement.innerHTML = this.getAppHTML();
            this.attachEventListeners();
            this.loadPhotos();
          }
        }
        
        getAppHTML() {
          return `
            <div style="min-height: 100vh; background: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
              <!-- Header -->
              <div style="background: #667eea; color: white; padding: 20px; text-align: center;">
                <h1 style="margin: 0; font-size: 24px;">üßπ Cleaning Photo App</h1>
                <p style="margin: 8px 0 0 0; opacity: 0.9;">iOS Safari Compatible Version</p>
              </div>
              
              <!-- Main Content -->
              <div style="padding: 20px; max-width: 500px; margin: 0 auto;">
                
                <!-- Room Selector -->
                <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <h3 style="margin: 0 0 15px 0; color: #1e293b;">Select Room</h3>
                  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    ${this.getRoomButtons()}
                  </div>
                </div>
                
                <!-- Mode Selector -->
                <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <h3 style="margin: 0 0 15px 0; color: #1e293b;">Photo Type</h3>
                  <div style="display: flex; gap: 10px;">
                    <button id="before-btn" style="flex: 1; padding: 12px; border: 2px solid #667eea; background: #667eea; color: white; border-radius: 8px; font-size: 16px;">
                      üì∏ Before
                    </button>
                    <button id="after-btn" style="flex: 1; padding: 12px; border: 2px solid #e2e8f0; background: white; color: #64748b; border-radius: 8px; font-size: 16px;">
                      üì∏ After
                    </button>
                  </div>
                </div>
                
                <!-- Camera Section -->
                <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <h3 style="margin: 0 0 15px 0; color: #1e293b;">Take Photo</h3>
                  <div style="text-align: center;">
                    <button id="camera-btn" style="background: #10b981; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 18px; cursor: pointer;">
                      üì∑ Open Camera
                    </button>
                    <p style="color: #64748b; font-size: 14px; margin: 10px 0 0 0;">
                      Note: Camera access requires HTTPS and user permission
                    </p>
                  </div>
                </div>
                
                <!-- Photos Gallery -->
                <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <h3 style="margin: 0 0 15px 0; color: #1e293b;">Photos (${this.photos.length})</h3>
                  <div id="photos-container" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    ${this.getPhotosHTML()}
                  </div>
                </div>
                
                <!-- Status -->
                <div style="background: #e0f2fe; border-radius: 12px; padding: 15px; text-align: center;">
                  <p style="margin: 0; color: #0369a1; font-size: 14px;">
                    üì± This version works on iOS Safari without ES6 modules
                  </p>
                </div>
                
              </div>
            </div>
          `;
        }
        
        getRoomButtons() {
          const rooms = ['kitchen', 'bathroom', 'bedroom', 'living-room', 'dining-room', 'office'];
          return rooms.map(room => `
            <button class="room-btn" data-room="${room}" 
                    style="padding: 10px; border: 1px solid #e2e8f0; background: ${this.currentRoom === room ? '#667eea' : 'white'}; color: ${this.currentRoom === room ? 'white' : '#64748b'}; border-radius: 6px; font-size: 14px;">
              ${room.charAt(0).toUpperCase() + room.slice(1).replace('-', ' ')}
            </button>
          `).join('');
        }
        
        getPhotosHTML() {
          if (this.photos.length === 0) {
            return '<p style="grid-column: 1 / -1; text-align: center; color: #64748b; font-style: italic;">No photos yet</p>';
          }
          return this.photos.map((photo, index) => `
            <div style="border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
              <img src="${photo.dataUrl}" style="width: 100%; height: 120px; object-fit: cover;" />
              <div style="padding: 8px; font-size: 12px; color: #64748b;">
                <div>${photo.room} - ${photo.mode}</div>
                <div>${new Date(photo.timestamp).toLocaleTimeString()}</div>
              </div>
            </div>
          `).join('');
        }
        
        attachEventListeners() {
          // Room selection
          document.querySelectorAll('.room-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
              this.currentRoom = e.target.dataset.room;
              this.init();
            });
          });
          
          // Mode selection
          document.getElementById('before-btn').addEventListener('click', () => {
            this.currentMode = 'before';
            this.updateModeButtons();
          });
          
          document.getElementById('after-btn').addEventListener('click', () => {
            this.currentMode = 'after';
            this.updateModeButtons();
          });
          
          // Camera
          document.getElementById('camera-btn').addEventListener('click', () => {
            this.openCamera();
          });
        }
        
        updateModeButtons() {
          const beforeBtn = document.getElementById('before-btn');
          const afterBtn = document.getElementById('after-btn');
          
          if (this.currentMode === 'before') {
            beforeBtn.style.background = '#667eea';
            beforeBtn.style.color = 'white';
            afterBtn.style.background = 'white';
            afterBtn.style.color = '#64748b';
          } else {
            beforeBtn.style.background = 'white';
            beforeBtn.style.color = '#64748b';
            afterBtn.style.background = '#667eea';
            afterBtn.style.color = 'white';
          }
        }
        
        async openCamera() {
          try {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
              alert('Camera not supported on this device');
              return;
            }
            
            // Try to use back camera first, fallback to any camera
            let stream;
            try {
              stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' } // Back camera
              });
            } catch (backCameraError) {
              console.log('Back camera not available, trying any camera:', backCameraError);
              stream = await navigator.mediaDevices.getUserMedia({ video: true });
            }
            
            // Create fullscreen camera modal
            const modal = document.createElement('div');
            modal.style.cssText = `
              position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
              background: black; z-index: 1000; display: flex; 
              flex-direction: column; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
              <!-- Fullscreen video with overlay controls -->
              <div style="position: relative; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center;">
                <video id="camera-video" autoplay style="width: 100%; height: 100%; object-fit: cover;"></video>
                
                <!-- Top overlay - only close button -->
                <div style="position: absolute; top: 0; right: 0; padding: 20px;">
                  <button id="close-camera-btn" style="background: rgba(0,0,0,0.6); color: white; border: none; padding: 15px; border-radius: 50%; font-size: 20px; cursor: pointer; backdrop-filter: blur(10px);">
                    ‚ùå
                  </button>
                </div>
                
                <!-- Bottom overlay controls -->
                <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 30px; display: flex; justify-content: center; align-items: center; gap: 20px;">
                  <!-- Camera switch button -->
                  <button id="switch-camera-btn" style="background: rgba(0,0,0,0.6); color: white; border: none; padding: 15px; border-radius: 50%; font-size: 20px; cursor: pointer; backdrop-filter: blur(10px);">
                    üîÑ
                  </button>
                  
                  <!-- Capture button -->
                  <button id="capture-btn" style="background: #10b981; color: white; border: none; padding: 20px; border-radius: 50%; font-size: 24px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                    üì∏
                  </button>
                  
                  <!-- Video switcher button -->
                  <button id="video-switcher-btn" style="background: rgba(0,0,0,0.6); color: white; border: none; padding: 15px; border-radius: 50%; font-size: 20px; cursor: pointer; backdrop-filter: blur(10px);">
                    üìπ
                  </button>
                </div>
              </div>
            `;
            
            document.body.appendChild(modal);
            
            const video = document.getElementById('camera-video');
            video.srcObject = stream;
            
            // Initialize in photo mode
            video.setAttribute('data-mode', 'photo');
            
            // Set initial button states for photo mode
            document.getElementById('video-switcher-btn').textContent = 'üìπ';
            document.getElementById('capture-btn').textContent = 'üì∏';
            
            // Store current facing mode
            let currentFacingMode = 'environment'; // Start with back camera
            
            document.getElementById('capture-btn').addEventListener('click', () => {
              this.capturePhoto(video, stream);
            });
            
            document.getElementById('switch-camera-btn').addEventListener('click', async () => {
              try {
                // Stop current stream
                stream.getTracks().forEach(track => track.stop());
                
                // Switch facing mode
                currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
                
                // Get new stream with switched camera
                const newStream = await navigator.mediaDevices.getUserMedia({ 
                  video: { facingMode: currentFacingMode }
                });
                
                // Update video source
                video.srcObject = newStream;
                
                // Update the stream reference for capture
                stream = newStream;
                
                console.log('Switched to', currentFacingMode === 'user' ? 'front' : 'back', 'camera');
              } catch (error) {
                console.log('Camera switch failed:', error);
                alert('Camera switch failed: ' + error.message);
              }
            });
            
            // Video switcher functionality
            document.getElementById('video-switcher-btn').addEventListener('click', async () => {
              try {
                // Stop current stream
                stream.getTracks().forEach(track => track.stop());
                
                // Switch between photo and video mode
                const isVideoMode = video.getAttribute('data-mode') === 'video';
                
                if (isVideoMode) {
                  // Switch to photo mode
                  video.setAttribute('data-mode', 'photo');
                  document.getElementById('video-switcher-btn').textContent = 'üìπ';
                  document.getElementById('capture-btn').textContent = 'üì∏';
                } else {
                  // Switch to video mode
                  video.setAttribute('data-mode', 'video');
                  document.getElementById('video-switcher-btn').textContent = 'üì∏';
                  document.getElementById('capture-btn').textContent = 'üé•';
                }
                
                // Get new stream
                const newStream = await navigator.mediaDevices.getUserMedia({ 
                  video: { facingMode: currentFacingMode }
                });
                
                // Update video source
                video.srcObject = newStream;
                
                // Update the stream reference
                stream = newStream;
                
                console.log('Switched to', isVideoMode ? 'photo' : 'video', 'mode');
              } catch (error) {
                console.log('Mode switch failed:', error);
                alert('Mode switch failed: ' + error.message);
              }
            });
            
            document.getElementById('close-camera-btn').addEventListener('click', () => {
              stream.getTracks().forEach(track => track.stop());
              document.body.removeChild(modal);
            });
            
          } catch (error) {
            alert('Camera access denied or failed: ' + error.message);
          }
        }
        
        capturePhoto(video, stream) {
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          
          context.drawImage(video, 0, 0);
          
          const photo = {
            dataUrl: canvas.toDataURL('image/jpeg', 0.8),
            room: this.currentRoom,
            mode: this.currentMode,
            timestamp: Date.now()
          };
          
          this.photos.push(photo);
          this.savePhotos();
          
          // Close camera
          stream.getTracks().forEach(track => track.stop());
          document.body.removeChild(document.querySelector('[style*="position: fixed"]'));
          
          // Refresh display
          this.init();
        }
        
        savePhotos() {
          localStorage.setItem('cleaning-photos', JSON.stringify(this.photos));
        }
        
        loadPhotos() {
          const saved = localStorage.getItem('cleaning-photos');
          if (saved) {
            this.photos = JSON.parse(saved);
          }
        }
      }
      
      // Initialize app
      new CleaningPhotoApp();
      console.log('‚úÖ Debug: iOS Safari compatible app loaded successfully');
    </script>
    
    <!-- Fallback for browsers that don't support ES6 modules -->
    <script nomodule>
      console.log('‚ùå Debug: ES6 modules not supported, using fallback');
      document.getElementById('debug-info').innerHTML += '<div style="color: orange;">‚ö†Ô∏è ES6 modules not supported</div>';
      
      // Show a simple message instead of React app
      setTimeout(() => {
        document.getElementById('root').innerHTML = `
          <div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">
            <h1>üö´ Browser Compatibility Issue</h1>
            <p>Your browser doesn't support ES6 modules, which are required for this app.</p>
            <p>Please update your browser or try a different browser.</p>
            <p style="color: #666; font-size: 14px;">iOS Safari 10.3+ is required for ES6 module support.</p>
          </div>
        `;
      }, 2000);
    </script>
    
    <script>
      // This will run after main.jsx loads (if it loads)
      console.log('‚úÖ Debug: main.jsx script tag processed');
    </script>
  </body>
</html>